function spos(e,t){return e+","+t}function ipos(e){let t=e.split(",");return{x:parseInt(t[0]),y:parseInt(t[1])}}class board{static tiles={};static arrFuncs={pieceModifiers:[]};static iterations=0;static topTile=0;static bottomTile=0;static AIwait(){return 10}static AIblockWait(){return 300}static emptyNew(){for(let e=0;e<8;e++)for(let t=0;t<12;t++)this.tiles[e+","+t]={}}}function getTileTeam(e,t){let a=board.tiles[e];return void 0!=a&&(void 0==a.piece?"empty":void 0!==a.piece.identifyTo?a.piece.identifyTo(t):a.piece.team==t?"block":"capture")}function movePiece(e,t,a,i,r){let o=spos(e,t);return void 0!=board.tiles[o].piece&&board.tiles[o].piece.team==r&&board.tiles[o].piece.move(a,i)}class piece{constructor(e,t,a,i,r){this.arrFuncs={onMove:[]},this.id=e,this.tags=r||{},this.x=t,this.y=a,this.premoves=[],this.team=i,this.kills=0,this.alive=!0,"rook"==e?(this.range=5,this.maxCD=15,this.renderLetter="R",this.legals=()=>{let e=[],t={};for(let a=1;a<this.range+1;a++){let i=spos(this.x+a,this.y),r=getTileTeam(i,this.team);if("empty"===r){e.push(i),t[i]=r;continue}if(!1==r||"block"==r)break;if("phase"!=r){if("capture"==r){e.push(i),t[i]=r;break}e.push(i),t[i]=r}}for(let o=1;o<this.range+1;o++){let s=spos(this.x,this.y+o),c=getTileTeam(s,this.team);if("empty"===c){e.push(s),t[s]=c;continue}if(!1==c||"block"==c)break;if("phase"!=c){if("capture"==c){e.push(s),t[s]=c;break}e.push(s),t[s]=c}}for(let l=1;l<this.range+1;l++){let n=spos(this.x-l,this.y),$=getTileTeam(n,this.team);if("empty"===$){e.push(n),t[n]=$;continue}if(!1==$||"block"==$)break;if("phase"!=$){if("capture"==$){e.push(n),t[n]=$;break}e.push(n),t[n]=$}}for(let m=1;m<this.range+1;m++){let d=spos(this.x,this.y-m),_=getTileTeam(d,this.team);if("empty"===_){e.push(d),t[d]=_;continue}if(!1==_||"block"==_)break;if("phase"!=_){if("capture"==_){e.push(d),t[d]=_;break}e.push(d),t[d]=_}}return{arr:e,dict:t}}):"cannon"==e?(this.range=9,this.maxCD=15,this.renderLetter="C",this.legals=()=>{let e=[],t={},a=!1;for(let i=1;i<this.range+1;i++){let r=spos(this.x+i,this.y),o=getTileTeam(r,this.team);if(a){if(!1==o||"block"==o)break;if("phase"==o)continue;if("capture"==o){e.push(r),t[r]=o;break}}else{if(!1==o||"block"==o||"capture"==o){a=!0;continue}if("phase"==o)continue;e.push(r),t[r]=o}}a=!1;for(let s=1;s<this.range+1;s++){let c=spos(this.x,this.y+s),l=getTileTeam(c,this.team);if(a){if(!1==l||"block"==l)break;if("phase"==l)continue;if("capture"==l){e.push(c),t[c]=l;break}}else{if(!1==l||"block"==l||"capture"==l){a=!0;continue}if("phase"==l)continue;e.push(c),t[c]=l}}a=!1;for(let n=1;n<this.range+1;n++){let $=spos(this.x-n,this.y),m=getTileTeam($,this.team);if(a){if(!1==m||"block"==m)break;if("phase"==m)continue;if("capture"==m){e.push($),t[$]=m;break}}else{if(!1==m||"block"==m||"capture"==m){a=!0;continue}if("phase"==m)continue;e.push($),t[$]=m}}a=!1;for(let d=1;d<this.range+1;d++){let _=spos(this.x,this.y-d),p=getTileTeam(_,this.team);if(a){if(!1==p||"block"==p)break;if("phase"==p)continue;if("capture"==p){e.push(_),t[_]=p;break}}else{if(!1==p||"block"==p||"capture"==p){a=!0;continue}if("phase"==p)continue;e.push(_),t[_]=p}}return{arr:e,dict:t}}):"queen"==e?(this.maxCD=16,this.range=5,this.renderLetter="Q",this.legals=()=>{let e=[],t={};for(let a=1;a<this.range+1;a++){let i=spos(this.x+a,this.y),r=getTileTeam(i,this.team);if(!1==r||"block"==r)break;if("phase"!=r){if("capture"==r){e.push(i),t[i]=r;break}e.push(i),t[i]=r}}for(let o=1;o<this.range+1;o++){let s=spos(this.x,this.y+o),c=getTileTeam(s,this.team);if(!1==c||"block"==c)break;if("phase"!=c){if("capture"==c){e.push(s),t[s]=c;break}e.push(s),t[s]=c}}for(let l=1;l<this.range+1;l++){let n=spos(this.x-l,this.y),$=getTileTeam(n,this.team);if(!1==$||"block"==$)break;if("phase"!=$){if("capture"==$){e.push(n),t[n]=$;break}e.push(n),t[n]=$}}for(let m=1;m<this.range+1;m++){let d=spos(this.x,this.y-m),_=getTileTeam(d,this.team);if(!1==_||"block"==_)break;if("phase"!=_){if("capture"==_){e.push(d),t[d]=_;break}e.push(d),t[d]=_}}for(let p=1;p<this.range+1;p++){let h=spos(this.x+p,this.y+p),u=getTileTeam(h,this.team);if(!1==u||"block"==u)break;if("phase"!=u){if("capture"==u){e.push(h),t[h]=u;break}e.push(h),t[h]=u}}for(let b=1;b<this.range+1;b++){let f=spos(this.x-b,this.y+b),x=getTileTeam(f,this.team);if(!1==x||"block"==x)break;if("phase"!=x){if("capture"==x){e.push(f),t[f]=x;break}e.push(f),t[f]=x}}for(let g=1;g<this.range+1;g++){let y=spos(this.x-g,this.y-g),w=getTileTeam(y,this.team);if(!1==w||"block"==w)break;if("phase"!=w){if("capture"==w){e.push(y),t[y]=w;break}e.push(y),t[y]=w}}for(let v=1;v<this.range+1;v++){let S=spos(this.x+v,this.y-v),k=getTileTeam(S,this.team);if(!1==k||"block"==k)break;if("phase"!=k){if("capture"==k){e.push(S),t[S]=k;break}e.push(S),t[S]=k}}return{arr:e,dict:t}}):"bishop"==e?(this.maxCD=12,this.range=5,this.renderLetter="B",this.legals=()=>{let e=[],t={};for(let a=1;a<this.range+1;a++){let i=spos(this.x+a,this.y+a),r=getTileTeam(i,this.team);if(!1==r||"block"==r)break;if("phase"!=r){if("capture"==r){e.push(i),t[i]=r;break}e.push(i),t[i]=r}}for(let o=1;o<this.range+1;o++){let s=spos(this.x-o,this.y+o),c=getTileTeam(s,this.team);if(!1==c||"block"==c)break;if("phase"!=c){if("capture"==c){e.push(s),t[s]=c;break}e.push(s),t[s]=c}}for(let l=1;l<this.range+1;l++){let n=spos(this.x-l,this.y-l),$=getTileTeam(n,this.team);if(!1==$||"block"==$)break;if("phase"!=$){if("capture"==$){e.push(n),t[n]=$;break}e.push(n),t[n]=$}}for(let m=1;m<this.range+1;m++){let d=spos(this.x+m,this.y-m),_=getTileTeam(d,this.team);if(!1==_||"block"==_)break;if("phase"!=_){if("capture"==_){e.push(d),t[d]=_;break}e.push(d),t[d]=_}}return{arr:e,dict:t}}):"knight"==e?(this.maxCD=10,this.renderLetter="N",this.jumps=[[2,1],[1,2],[-1,2],[-2,1],[1,-2],[-1,-2],[-2,-1],[2,-1]],this.legals=()=>{let e=[],t={};return this.jumps.forEach(a=>{let i=spos(a[0]+this.x,a[1]+this.y),r=getTileTeam(i,this.team);("capture"==r||"empty"==r)&&(e.push(i),t[i]=r)}),{arr:e,dict:t}}):"king"==e?(this.maxCD=20,"zombies"==this.team&&(this.maxCD=20),this.renderLetter="K",this.jumps=[[0,1],[0,-1],[-1,1],[1,-1],[1,0],[-1,0],[-1,-1],[1,1]],this.legals=()=>{let e=[],t={};return this.jumps.forEach(a=>{let i=spos(a[0]+this.x,a[1]+this.y),r=getTileTeam(i,this.team);("capture"==r||"empty"==r)&&(e.push(i),t[i]=r)}),{arr:e,dict:t}}):"pawn"==e?(this.maxCD=7,this.renderLetter="P","y+"==this.tags.direction&&(this.legals=()=>{let e=[],t={};return"empty"==getTileTeam(spos(this.x,this.y+1),this.team)&&(e.push(spos(this.x,this.y+1)),t[spos(this.x,this.y+1)]="empty"),"capture"==getTileTeam(spos(this.x+1,this.y+1),this.team)&&(e.push(spos(this.x+1,this.y+1)),t[spos(this.x+1,this.y+1)]="capture"),"capture"==getTileTeam(spos(this.x-1,this.y+1),this.team)&&(e.push(spos(this.x-1,this.y+1)),t[spos(this.x-1,this.y+1)]="capture"),{arr:e,dict:t}},this.arrFuncs.onMove.push(()=>{11==this.y&&(board.tiles[spos(this.x,this.y)].piece=new piece("queen",this.x,this.y,this.team))})),"y-"==this.tags.direction&&(this.legals=()=>{let e=[],t={};return 10==this.y&&"empty"==getTileTeam(spos(this.x,this.y-2),this.team)&&(e.push(spos(this.x,this.y-2)),t[spos(this.x,this.y-2)]="empty"),"empty"==getTileTeam(spos(this.x,this.y-1),this.team)&&(e.push(spos(this.x,this.y-1)),t[spos(this.x,this.y-1)]="empty"),"capture"==getTileTeam(spos(this.x+1,this.y-1),this.team)&&(e.push(spos(this.x+1,this.y-1)),t[spos(this.x+1,this.y-1)]="capture"),"capture"==getTileTeam(spos(this.x-1,this.y-1),this.team)&&(e.push(spos(this.x-1,this.y-1)),t[spos(this.x-1,this.y-1)]="capture"),{arr:e,dict:t}},this.arrFuncs.onMove.push(()=>{void 0==board.tiles[spos(this.x,this.y-1)]&&(board.tiles[spos(this.x,this.y)].piece=new piece("queen",this.x,this.y,this.team))}))):"wizard"==e&&(this.maxCD=20,this.upLim=1/0,this.held=!1,"zombies"==this.team&&(this.maxCD=20),this.renderLetter="W",this.jumps=[[0,1],[0,-1],[-1,1],[1,-1],[1,0],[-1,0],[-1,-1],[1,1]],this.legals=()=>{let e=[],t={};return this.jumps.forEach(a=>{let i=spos(a[0]+this.x,a[1]+this.y),r=getTileTeam(i,this.team);("capture"==r||"empty"==r)&&(e.push(i),t[i]=r)}),{arr:e,dict:t}},this.downed=()=>{this.upLim=Date.now()+2e3},this.hold=e=>{e>this.upLim&&!0!==this.held&&(camera.particles.push(new explosionR(mouseX/tileSize-camera.x,mouseY/tileSize-camera.y,"rgba(0,255,255,0.8)",10,18,.2)),this.held=!0);let t=1-(this.upLim-e)/2e3;if(ctx.lineWidth=tileSize/8,this.held){let a=255*Math.random();ctx.strokeStyle="rgb(0,"+a+","+a+")"}else ctx.strokeStyle="rgb(0,255,255)";return chargeArc(mouseX,mouseY,23,t),t},this.unhold=(e,t)=>{if(this.held){if(board.tiles[spos(e,t)],killBoardPiece(e,t,this)){for(let a=0;a<26;a++){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(e+.5+.6*i,t+.5+.6*r,44*i,44*r,.03*Math.random(),3*Math.random()+3,!1))}camera.particles.push(new explosionR(e+.5+(Math.random()-.5)*.7,t+.5+(Math.random()-.5)*.7,"rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.3*Math.random()+.3)+")",4,6+2*Math.random(),.2));for(let o=0;o<3;o++)setTimeout(()=>{camera.particles.push(new explosionR(e+.5+(Math.random()-.5)*.7,t+.5+(Math.random()-.5)*.7,"rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.3*Math.random()+.3)+")",4,6+2*Math.random(),.2))},400*Math.random())}camera.playSound("shot"),camera.particles.push(new lineParticle(this.x+.5,this.y+.5,e+.5,t+.5,10,e=>{let t=255*Math.random();return"rgb(0,"+t+","+t+")"},.6))}this.cooldown=this.maxCD+5,this.coolUntil=Date.now()+1e3*this.cooldown,this.uplim=void 0,this.held=!1}),this.cooldown=2,this.coolUntil=Date.now()+2e3,"zombies"==this.team&&(this.maxCD+=1)}move(e,t){let a=spos(e,t),i=this.legals();if(i.arr,void 0==i.dict[a])return!1;board.tiles[spos(this.x,this.y)].piece=void 0;let r=this.x,o=this.y;return this.x=e,this.y=t,void 0!=board.tiles[a].piece&&(void 0!=board.tiles[a].piece.onDeath&&board.tiles[a].piece.onDeath(),board.tiles[a].piece.alive=!1,kill(this.x,this.y),this.kills+=1,"zombies"!=this.team&&displayKills(this.kills,this.x,this.y),console.log(board.tiles[a].piece.team+" "+board.tiles[a].piece.id+" has been killed!")),board.tiles[a].piece=this,this.cooldown=this.maxCD,this.coolUntil=Date.now()+1e3*this.maxCD,this.arrFuncs.onMove.forEach(e=>{e(r,o,this,i.dict[a])}),i.dict[a]}CDcheck(){if(0==this.cooldown)return 0;let e=Date.now();return(this.cooldown=(this.coolUntil-e)/1e3,this.cooldown<=0)?(this.cooldown=0,this.cooldownFinish(),0):this.cooldown}cooldownFinish(){if("zombies"==this.team)setTimeout(()=>{AImoveRandom(this)},void 0==this.AIwait?board.AIwait():this.AIwait());else{camera.particles.push(new explosionR(this.x+.5,this.y+.5,"rgba(255,255,0,0.5)",10,18,.2));let e=!1;for(;!e&&this.premoves.length>0;)e=attemptMove(this.x,this.y,this.premoves[0][0],this.premoves[0][1],this.team),friendlyMoved(e),this.premoves.splice(0,1)}}}function setPieceCooldown(e,t){e.cooldown=t,e.coolUntil=Date.now()+1e3*t}function killBoardPiece(e,t,a){let i=spos(e,t);if(void 0!=board.tiles[i]&&void 0!=board.tiles[i].piece)return void 0!=board.tiles[i].piece.onDeath&&board.tiles[i].piece.onDeath(),board.tiles[i].piece.alive=!1,a.kills+=1,"zombies"!=a.team&&displayKills(a.kills,a.x,a.y),console.log(board.tiles[i].piece.team+" "+board.tiles[i].piece.id+" has been killed!"),board.tiles[i].piece=void 0,!0}function AImoveRandom(e){void 0!==e.AImoveRandom&&e.AImoveRandom(e);let t=e.legals(),a=t.arr;if(0==a.length){setTimeout(()=>{AImoveRandom(e)},void 0==e.AIblockWait?board.AIblockWait():e.AIblockWait());return}let i=[];if(a.forEach(e=>{"capture"==t.dict[e]&&i.push(e)}),i.length>0){let r=ipos(i[Math.floor(Math.random()*i.length)]),o=e.x,s=e.y;"capture"==attemptMove(e.x,e.y,r.x,r.y,e.team)&&(camera.playSoundF("0"),camera.particles.push(new lineParticle(o+.5,s+.5,e.x+.5,e.y+.5,10,e=>{let t=255*Math.random();return"rgb("+(t<20?255-t:0)+","+t/2+",0)"},.1)))}if(void 0==board.tiles[spos(e.x,e.y)]||void 0==board.tiles[spos(e.x,e.y)].piece)return;let c;for(;0==e.cooldown&&e==board.tiles[spos(e.x,e.y)].piece;){let l=ipos(a[Math.floor(Math.random()*a.length)]);!(ipos.y<e.y&&Math.random()>.6)&&(c=attemptMove(e.x,e.y,l.x,l.y,e.team))}return c}function attemptMove(e,t,a,i,r){let o=spos(e,t),s=spos(a,i),c=board.tiles[o];return void 0!=c&&void 0!=board.tiles[s]&&void 0!=c.piece&&c.piece.team==r&&0==c.piece.cooldown&&movePiece(e,t,a,i,r)}function board_to_screen(e,t){return[(e+camera.x)*tileSize,(t+camera.y)*tileSize]}function screen_to_board(e,t){return[e/tileSize-camera.x,t/tileSize-camera.y]}class expandingText{constructor(e,t,a,i,r,o){this.x=t,this.text=e,this.speed=r||1,this.s2=(o||1)/5,this.y=a,this.colorf=i,this.size=3,this.actLife=600,this.lastTime=Date.now()}update(e){this.size+=this.speed*(e-this.lastTime)/50,this.actLife-=this.s2*(e-this.lastTime),this.lastTime=e}draw(){if(this.actLife<0)return"del";ctx.textAlign="center",ctx.fillStyle=this.colorf(this.actLife/600),ctx.beginPath(),ctx.font="bold "+this.size+"px Courier New";let e=board_to_screen(this.x+.5,this.y+.5);ctx.fillText(this.text,e[0],e[1])}}class explosionR{constructor(e,t,a,i,r,o){this.x=e,this.speed=i||1,this.s2=(r||1)/5,this.y=t,this.color=a,"string"!=typeof a&&(this.colorf=a,this.color="#FF00FF"),this.size=3,this.lineWidth=o||1,this.actLife=600,this.lastTime=Date.now()}update(e){this.size+=this.speed*(e-this.lastTime)/50,this.actLife-=this.s2*(e-this.lastTime),this.lastTime=e,void 0!==this.colorf&&(this.color=this.colorf(this.actLife/600))}draw(){if(this.actLife<0)return"del";ctx.strokeStyle=this.color,ctx.lineWidth=(1+this.actLife/10)*this.lineWidth*camera.tileRsize,ctx.beginPath();let e=board_to_screen(this.x,this.y);ctx.arc(e[0],e[1],this.size*camera.tileRsize,0,2*Math.PI),ctx.stroke()}}function chargeArc(e,t,a,i){ctx.beginPath(),ctx.arc(e,t,a,-.5*Math.PI,2*Math.PI*i-.5*Math.PI),ctx.stroke()}function kill(e,t){for(let a=0;a<16;a++){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(e+.5+.6*i,t+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}camera.particles.push(new explosionR(e+.5+(Math.random()-.5)*.7,t+.5+(Math.random()-.5)*.7,"rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.3*Math.random()+.3)+")",2,6+2*Math.random(),.2));for(let o=0;o<3;o++)setTimeout(()=>{camera.particles.push(new explosionR(e+.5+(Math.random()-.5)*.7,t+.5+(Math.random()-.5)*.7,"rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.3*Math.random()+.3)+")",2,6+2*Math.random(),.2))},400*Math.random())}class lineParticle{constructor(e,t,a,i,r,o,s){this.x=e,this.y=t,this.tx=a,this.ty=i,this.size=r,this.colorf=o,this.actLife=1e3,this.s2=s||1,this.lastTime=Date.now()}update(e){this.actLife-=this.s2*(e-this.lastTime),this.lastTime=e}draw(){if(this.actLife<1)return"del";ctx.strokeStyle=this.colorf(this.actLife/1e3);let e=board_to_screen(this.x,this.y),t=board_to_screen(this.tx,this.ty);ctx.lineWidth=this.size*(this.actLife/1e3)*camera.tileRsize,ctx.beginPath(),ctx.moveTo(e[0],e[1]),ctx.lineTo(t[0],t[1]),ctx.stroke()}}class bloodParticle{constructor(e,t,a,i,r,o,s){this.x=e,this.y=t,this.vx=a/100,this.vy=i/100,this.rv=r/300,this.friction=.9,this.size=o,this.actualSize=o,this.duplicator=!!s&&s,this.color="rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.3*Math.random()+.3)+")",this.lastTime=Date.now(),this.life=1e3+3e3*Math.random()}update(e){let t=e-this.lastTime;this.life<1e3&&(this.actualSize=this.size*Math.sqrt(this.life)/31.62),this.life-=(e-this.lastTime)/2,this.lastTime=e,this.vx+=(Math.random()-.5)*this.rv*t,this.vy+=(Math.random()-.5)*this.rv*t,this.vx*=this.life>700?this.friction:this.life/700,this.vy*=this.life>700?this.friction:this.life/700,this.x+=this.vx,this.y+=this.vy}draw(){if(this.life<0)return"del";ctx.strokeStyle=this.color,ctx.fillStyle=this.color,ctx.lineWidth=(1+this.actLife/10)*this.lineWidth,ctx.beginPath();let e=board_to_screen(this.x,this.y);ctx.arc(e[0],e[1],this.actualSize*camera.tileRsize,0,2*Math.PI),ctx.fill(),ctx.closePath()}}function displayKills(e,t,a,i,r){r=r||7,i=i||4;let o;e<11?o=t=>"rgba(250,"+(250-25*e)+","+(250-25*e)+","+2.5*t+")":e%10==0?(o=e=>"rgba(0,0,"+150*Math.random()+","+2.5*e+")",4==i&&(i=2.5)):o=t=>"rgba("+(250-3*e+Math.random()*e*3)+",0,0,"+2.5*t+")",camera.particles.splice(0,0,new expandingText(e,t,a,o,r+e/20,i))}var gameEvents={"elite knight"(){camera.particles.push(new expandingText("An Elite Knight Spawned",Width/2/tileSize-camera.x,Height/2/tileSize-camera.y,e=>"rgba(255,255,0,"+e+")",.5,.9)),camera.particles[camera.particles.length-1].size=tileSize/2,board.tiles["4,0"].piece=new piece("knight",4,0,"zombies");let e=board.tiles["4,0"].piece;e.maxCD=3,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.95){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}return!0},e.AIwait=()=>10,e.AIblockWait=()=>300},"elite rook"(){board.tiles["4,0"].piece=new piece("rook",4,0,"zombies");let e=board.tiles["4,0"].piece;e.maxCD=4,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.95){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}return!0},e.AIwait=()=>10,e.AIblockWait=()=>300},"elite bishop"(){board.tiles["4,0"].piece=new piece("bishop",4,0,"zombies");let e=board.tiles["4,0"].piece;e.maxCD=4,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.95){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}return!0},e.AIwait=()=>10,e.AIblockWait=()=>300},"elite queen"(){board.tiles["4,0"].piece=new piece("queen",4,0,"zombies");let e=board.tiles["4,0"].piece;e.maxCD=5,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.95){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}return!0},e.AIwait=()=>10,e.AIblockWait=()=>300},"elite cannon"(){let e=spawnZombie(new piece("cannon",4,0,"zombies"));!1!==e&&(e.maxCD=5,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.95){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,14*i,14*r,.03*Math.random(),3*Math.random()+3,!1))}return!0},e.AIwait=()=>10,e.AIblockWait=()=>300)},"board expansion"(e,t){e=e||20;for(let a=0;a<e;a++)setTimeout(()=>{let e=t?-1*t:20;for(console.log(e);Math.random()>.4;)e-=1;let a=Math.floor(8*Math.random());void 0==board.tiles[a+","+e]&&(board.tiles[a+","+e]={},e<board.topTile&&(board.topTile=e))},200*a)},"piece storm"(e,t){e=e?1e3*e:2e3,startGameInterval(t=t||100),setTimeout(()=>{startGameInterval(camera.pieceFrequency)},e)},"bomber pawn"(){let e=spawnZombie(new piece("pawn",4,0,"zombies",{direction:"y+"}));if(!1!==e)return camera.particles.push(new expandingText("An bomber has Spawned",Width/2/tileSize-camera.x,Height/2/tileSize-camera.y,e=>"rgba(255,255,0,"+e+")",.5,.9)),camera.particles[camera.particles.length-1].size=tileSize/2,e.color="rgb(50,150,0)",e.draw=(e,t,a)=>{if(Math.random()>.9){let i=Math.random()-.5,r=Math.random()-.5;camera.particles.push(new bloodParticle(t+.5+.6*i,a+.5+.6*r,7*i,7*r,.03*Math.random(),3*Math.random()+3,!1));let o=235*Math.random()+20;camera.particles[camera.particles.length-1].color="rgba("+o+","+Math.random()*o+","+15*Math.random()+","+(.3*Math.random()+.3)+")"}return!0},e.arrFuncs.onMove.push(()=>{(Math.random()>.9||11==e.y)&&e.onDeath()}),e.onDeath=()=>{e.onDeath=void 0,camera.playSound("bomb");for(let t=0;t<16;t++){let a=Math.random()-.5,i=Math.random()-.5;camera.particles.push(new bloodParticle(e.x+.5+.6*a,e.y+.5+.6*i,34*a,34*i,.2*Math.random(),3*Math.random()+3,!1)),camera.particles[camera.particles.length-1].friction=.98}camera.particles.push(new explosionR(e.x+.5,e.y+.5,e=>{let t=250*Math.random();return"rgb("+t+","+Math.random()*t+","+15*Math.random()+")"},16,8,2)),camera.particles.push(new explosionR(e.x+.5,e.y+.5,e=>{let t=250*Math.random();return"rgb("+t+","+Math.random()*t+","+15*Math.random()+")"},6,2,1)),setTimeout(()=>{for(let t=-1;t<2;t++)for(let a=-1;a<2;a++)if(board.tiles[spos(e.x+t,e.y+a)]?.piece!=void 0){let i=board.tiles[spos(e.x+t,e.y+a)].piece;void 0!=i.onDeath&&i!=e&&i.onDeath(),i.alive=!1,board.tiles[spos(e.x+t,e.y+a)].piece=void 0;for(let r=0;r<16;r++){let o=Math.random()-.5,s=Math.random()-.5;o+=(i.x-e.x)*.3,s+=(i.y-e.y)*.3,camera.particles.push(new bloodParticle(i.x+.5+.6*o,i.y+.5+.6*s,24*o,24*s,.03*Math.random(),3*Math.random()+3,!1)),camera.particles[camera.particles.length-1].friction=.94}}},200)},e.AIwait=()=>10,e.AIblockWait=()=>300,e}};function spawnZombie(e){let t=Math.floor(8*Math.random());for(let a=0;a<8;a++){let i=(t+a)%8,r=board.topTile;for(;(void 0==board.tiles[i+","+r]||void 0!=board.tiles[i+","+r].piece)&&!((r+=1)>1););if(!(r>1))return board.tiles[i+","+r].piece=e,e.x=i,e.y=r,e}return!1}let tv={int:0,deg:0,rmom:[0,0,0,0],cr:0,cg:0,cb:0,gg:125*Math.random()+125},buttonInterval=setInterval(()=>{tv.int+=.1,tv.rmom.forEach((e,t)=>{tv.rmom[t]+=Math.random()-.5,tv.rmom[t]<-5&&(tv.rmom[t]=-5),tv.rmom[t]>5&&(tv.rmom[t]=5)}),tv.deg+=tv.rmom[0]/5,tv.cr+=tv.rmom[1],tv.cg+=tv.rmom[2],tv.cb+=tv.rmom[3],tv.cr=Math.abs(250-(tv.cr+250)%500),tv.cg=Math.abs(250-(tv.cg+250)%500),tv.cb=Math.abs(250-(tv.cb+250)%500);document.getElementById("wow").style.background="linear-gradient("+tv.deg/2+"deg, rgba("+tv.cr+","+tv.cg+","+tv.cb+",1) "+(50-tv.int<0?0:50-tv.int)+"%, rgba(0,"+tv.gg+",44,1) 100%)"},20),myCanvas=document.getElementById("myCanvas"),Height=window.innerHeight,Width=window.innerWidth;myCanvas.style.top=0,myCanvas.style.left=0,myCanvas.width=Width,myCanvas.height=Height,myCanvas.style.position="absolute",document.getElementById("help").style.width=Math.floor(Width-20)+"px",document.getElementById("help").style.height=Math.floor(Height)+"px",document.getElementById("help").style.position="absolute",document.getElementById("help").style.left=0,document.getElementById("help").style.top=0,document.getElementById("help").innerHTML="help menu unfinished";let CTX={main:myCanvas.getContext("2d")},ctx=CTX.main;function rect(e,t,a,i){ctx.fillRect(e,t,a,i)}function initSounds(e){e.forEach(e=>{let t=new Tone.Sampler({urls:{C4:"./sounds/"+e+".wav"}}).toDestination();camera.sounds[e]=t})}ctx.textAlign="center",ctx.textBaseline="middle";let pieceDict={Q:[[200,46],[177,57],[177,84],[192,94],[173,195],[136,102],[150,76],[123,52],[99,70],[118,109],[113,187],[74,130],[81,94],[52,74],[31,112],[54,132],[74,242],[104,281],[74,337],[150,357],[200,357],[200,357],[250,357],[326,337],[296,281],[326,242],[346,132],[369,112],[348,74],[319,94],[326,130],[287,187],[282,109],[301,70],[277,52],[250,76],[264,102],[227,195],[208,94],[223,84],[223,57],[200,46]],K:[[190,49],[189,64],[169,63],[169,81],[188,85],[190,104],[168,120],[160,150],[123,126],[65,147],[42,202],[65,243],[106,273],[105,336],[158,357],[200,361],[200,361],[242,357],[295,336],[294,273],[335,243],[358,202],[335,147],[277,126],[240,150],[232,120],[210,104],[212,85],[231,81],[231,63],[211,64],[210,49],[200,49]],R:[[200,75],[172,76],[171,96],[140,96],[129,77],[93,77],[91,131],[115,157],[118,269],[98,283],[96,313],[73,316],[71,358],[200,357],[200,357],[329,358],[327,316],[304,313],[302,283],[282,269],[285,157],[309,131],[307,77],[271,77],[260,96],[229,96],[228,76],[200,75]],B:[[200,25],[113,193],[149,237],[122,285],[156,306],[82,313],[46,342],[62,359],[185,361],[200,345],[200,345],[215,361],[338,359],[354,342],[318,313],[244,306],[278,285],[251,237],[287,193],[200,25]],P:[[200,73],[163,87],[157,123],[172,137],[141,159],[136,203],[157,230],[116,257],[92,347],[200,351],[200,351],[308,347],[284,257],[243,230],[264,203],[259,159],[228,137],[243,123],[237,87],[200,73]],N:[[155,89],[122,63],[116,102],[69,174],[47,232],[63,271],[87,275],[96,256],[103,262],[102,285],[142,244],[153,247],[206,184],[186,256],[142,299],[127,356],[344,354],[326,177],[261,102],[203,84],[188,51],[167,87]],W:[[336,27],[135,124],[78,292],[19,332],[384,320],[311,279],[243,156],[335,29]],C:[[385,80],[332,106],[334,117],[311,128],[304,118],[180,179],[141,115],[132,122],[148,157],[98,180],[97,219],[60,237],[74,269],[83,266],[84,275],[46,275],[33,299],[3,301],[3,308],[38,309],[57,286],[88,288],[105,307],[132,321],[165,317],[192,293],[200,262],[192,234],[179,219],[184,216],[202,243],[213,237],[198,211],[319,150],[317,142],[339,129],[345,135],[400,110],[390,81]]};class camera{static gamemode="none";static team="p1";static pieceRender="image";static increaseMargin=1;static menuButtonSize=40;static pieceFrequency=1300;static escaped=!1;static escapePos=[0,0];static specialRenderOn=!0;static x=1.2;static y=1.2;static particles=[];static sounds={};static soundArr=[];static tileRsize=1;static soundOn=!0;static playSound(e,t){!1!==this.soundOn&&(t=t||"C4",this.sounds[e].triggerAttack(t))}static playSoundF(e){!1!==this.soundOn&&sampler1.triggerAttack([soundMapper[e]])}static playSoundURL(e){if(!1===this.soundOn)return;let t=new Tone.Player(e).toDestination();t.onStop=()=>{t.dispose()},t.autostart=!0}static captureStreak=0}let initSoundsArr=["bomb","shot","escape","select","move","captureF","capture","captureS1","captureS2","captureS3","captureS4","captureS5","captureS6","captureS7","captureS8"];function fill(e,t,a,i){let r="rgba("+e+","+t+","+a+","+(i=void 0==i?1:i)+")";return ctx.fillStyle=r,r}initSounds(initSoundsArr);let mouseX=0,mouseY=0,mouseBoardX=0,mouseBoardY=0,tileSize=50;function mrect(e,t,a,i){a=a||1,i=i||1,rect((e+camera.x)*tileSize,(t+camera.y)*tileSize,tileSize*a,tileSize*i)}let keyDowns={};function mouseToBoardUpdate(){nx=Math.floor(mouseX/tileSize-camera.x),ny=Math.floor(mouseY/tileSize-camera.y),(nx!=mouseBoardX||ny!=mouseBoardY)&&(mouseBoardY=ny,mouseBoardX=nx,render())}document.addEventListener("keydown",e=>{let t=e.key;void 0==keyDowns[t]&&("w"==t&&(keyDowns[t]=setInterval(()=>{camera.y+=.7},60)),"s"==t&&(keyDowns[t]=setInterval(()=>{camera.y-=.7},60)),"a"==t&&(keyDowns[t]=setInterval(()=>{camera.x+=.7},60)),"d"==t&&(keyDowns[t]=setInterval(()=>{camera.x-=.7},60)),"Escape"==t&&escaped())}),document.addEventListener("keyup",e=>{let t=e.key;clearInterval(keyDowns[t]),keyDowns[t]=void 0}),onmousemove=e=>{if(mouseX=e.clientX,mouseY=e.clientY-2,mouseToBoardUpdate(),mouseDown){let t=spos(mouseDownPlace[0],mouseDownPlace[1]);(void 0==board.tiles[t]||void 0==board.tiles[t].piece)&&(camera.x+=(mouseX-mouseDeltaMovement[0])/tileSize,camera.y+=(mouseY-mouseDeltaMovement[1])/tileSize,mouseDeltaMovement=[mouseX,mouseY])}},document.addEventListener("wheel",e=>{let t=screen_to_board(Width/2,Height/2);(tileSize-=e.deltaY/40)<4&&(tileSize=4),camera.tileRsize=tileSize/50;let a=screen_to_board(Width/2,Height/2);camera.x+=a[0]-t[0],camera.y+=a[1]-t[1]});let mouseDownPlace=[0,0],mouseDeltaMovement=[0,0],pieceSelected="none",pieceDowned="none",pieceClicked="none",mouseDown=!1;document.addEventListener("contextmenu",e=>{e.preventDefault()}),document.addEventListener("mousedown",e=>{mouseX=e.clientX,mouseY=e.clientY-2,mouseToBoardUpdate(),mouseDownPlace=[mouseBoardX,mouseBoardY,mouseX,mouseY],mouseDeltaMovement=[mouseX,mouseY],mouseToBoardUpdate(),mouseDown=!0;let t=board.tiles[spos(mouseBoardX,mouseBoardY)];void 0!=t&&void 0!=t.piece&&t.piece.team==camera.team&&(pieceClicked=t.piece,0==t.piece.cooldown&&(pieceDowned=t.piece,void 0!==t.piece.downed&&t.piece.downed()))});let gameStart="mode",specialRender;function specialRenderIn(){specialRender=()=>{fill(255,255,255),ctx.textAlign="left",ctx.font="bold "+Math.floor(.8*tileSize)+"px Courier New",drawText("Choose game mode:",0,-1),drawText("Normal",1,0),drawText("King's Raid",1,2),drawText("Knight's Raid",1,4),drawText("Roaming",1,6),drawText("Phantom",1,8),drawText("Universal",1,10),fill(155,0,255,Math.random()),ctx.beginPath();let e=board_to_screen(.1,.85),t=board_to_screen(.9,.85),a=board_to_screen(.5,0);ctx.moveTo(e[0],e[1]+2*tileSize),ctx.lineTo(t[0],t[1]+2*tileSize),ctx.lineTo(a[0],a[1]+2*tileSize),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(e[0],e[1]+4*tileSize),ctx.lineTo(t[0],t[1]+4*tileSize),ctx.lineTo(a[0],a[1]+4*tileSize),ctx.fill(),ctx.closePath();let i=ctx.createLinearGradient(0,a[1],0,t[1]);i.addColorStop(1,"#488000"),i.addColorStop(.1,"#20FFA0"),ctx.fillStyle=i,ctx.beginPath(),ctx.moveTo(e[0],e[1]),ctx.lineTo(t[0],t[1]),ctx.lineTo(a[0],a[1]),ctx.fill(),ctx.closePath(),ctx.fillStyle="#488000",ctx.beginPath(),ctx.moveTo(e[0],e[1]+10*tileSize),ctx.lineTo(t[0],t[1]+10*tileSize),ctx.lineTo(a[0],a[1]+10*tileSize),ctx.fill(),ctx.closePath(),ctx.fillStyle="#F9F900",drawText("K",0,2),drawText("N",0,4),drawText("&",0,6)}}function menuRender(){let e=Math.random();camera.x-=Math.floor(camera.escapePos[0]),camera.y-=Math.floor(camera.escapePos[1]),ctx.font="bold "+Math.floor(.8*tileSize)+"px Courier New",ctx.textAlign="left",fill(0,0,0,.8),ctx.fillRect(0,0,Width,Height),fill(255*e,0,0),mrect(0,-1.8,1,.6),fill(255*e,255*e,0),mrect(0,-3.8,1,.6),ctx.fillStyle="#FFFFFF",drawText("Quit",1,-2),drawText("Send to origin",1,-4),drawText("Buttons & Switches:",0,0),drawText("Piece render mode ["+camera.pieceRender+"]",2,1),drawText("Sounds ["+(camera.soundOn?"on":"off")+"]",2,3),drawText("Play random sound",2,5),drawText("Increase margin ["+camera.increaseMargin+"]",2,7),drawText("Menu button size ["+camera.menuButtonSize+"]",2,9),drawText("Tilesize ["+tileSize.toPrecision(3)+"]",2,11),camera.pieceRender,fill(255,255,255),("image"==camera.pieceRender?()=>{fill(255,255,0)}:()=>{fill(255,255,255)})(),mrect(.2,1.2,.6,.6),(camera.soundOn?()=>{fill(0,255,0)}:()=>{fill(255,0,0)})(),mrect(.2,3.2,.6,.6),mrect(.2,5.2,.6,.6),fill(255,0,0),mrect(.2,7.2,.8,.6),mrect(.2,9.2,.8,.6),mrect(.2,11.2,.8,.6),fill(0,255,0),mrect(1,7.2,.8,.6),mrect(1,9.2,.8,.6),mrect(1,11.2,.8,.6),camera.x+=Math.floor(camera.escapePos[0]),camera.y+=Math.floor(camera.escapePos[1])}function drawText(e,t,a){ctx.fillText(e,(t+camera.x+.26)*tileSize,(a+camera.y+.56)*tileSize)}function friendlyMoved(e){if(!1!=e){if(console.log(e),"empty"==e)camera.captureStreak=0,camera.playSoundF(1);else if("capture"==e&&camera.captureStreak<4)camera.captureStreak+=1,camera.playSoundF(2);else{camera.captureStreak+=1;let t=camera.captureStreak>8?9+Math.floor((camera.captureStreak-9)/2):camera.captureStreak;t=t>13?13:t,camera.playSoundF(t-1)}}}function drawPiece(e,t,a,i,r,o){if((0!=r&&(i==camera.team?fill(0,0,150,.3):fill(150,0,0,.3),mrect(t,a,1,r>1?1:r)),void 0!==o.color?ctx.fillStyle=o.color:i==camera.team?(fill(255,255,255),0!=r&&fill(250,180,180)):fill(0,100,0),"image"===camera.pieceRender&&void 0!=pieceDict[e])?pieceImage(t,a,pieceDict[e]):ctx.fillText(e,(t+camera.x+.5)*tileSize,(a+camera.y+.56)*tileSize),i==camera.team&&o.premoves.length>0){ctx.lineWidth=2;let s=[o.x+.5,o.y+.5];for(let c=0;c<o.premoves.length;c++){ctx.strokeStyle="rgb("+(255-40*c)+",0,0)",ctx.beginPath();let l=board_to_screen(s[0],s[1]),n=board_to_screen(o.premoves[c][0]+.5,o.premoves[c][1]+.5);s=[o.premoves[c][0]+.5,o.premoves[c][1]+.5],ctx.moveTo(l[0],l[1]),ctx.lineTo(n[0],n[1]),ctx.stroke()}}}function pieceImage(e,t,a){ctx.beginPath(),ctx.moveTo(a[0][0]/(400/tileSize)+(e+camera.x)*tileSize,a[0][1]/(400/tileSize)+(t+camera.y)*tileSize);for(let i=1;i<a.length;i++)ctx.lineTo(a[i][0]/(400/tileSize)+(e+camera.x)*tileSize,a[i][1]/(400/tileSize)+(t+camera.y)*tileSize);ctx.fill(),ctx.closePath()}function render(){fill(0,0,0),rect(0,0,Width,Height);let e=Object.keys(board.tiles);e.forEach(e=>{let t=ipos(e),a=board.tiles[e];void 0!=a&&((t.x+t.y)%2==1?fill(60,60,60):fill(70,70,70),void 0!=a.color&&(ctx.fillStyle=a.color()),mrect(t.x,t.y))}),"none"!=pieceSelected&&(0==pieceSelected.cooldown?fill(40,155,40,.2):fill(120,120,40,.2),pieceSelected.temporaryLegals.forEach(e=>{let t=ipos(e);mrect(t.x,t.y)})),ctx.font="bold "+Math.floor(.8*tileSize)+"px Courier New",e.forEach(e=>{ipos(e);let t=board.tiles[e];if(ctx.textAlign="center",void 0!=t.piece){let a=t.piece;(a.CDcheck(),void 0!==a.draw)?a.draw(a.renderLetter,a.x,a.y,a.team,a.cooldown/a.maxCD,a)&&drawPiece(a.renderLetter,a.x,a.y,a.team,a.cooldown/a.maxCD,a):drawPiece(a.renderLetter,a.x,a.y,a.team,a.cooldown/a.maxCD,a)}}),ctx.lineWidth=Math.round(tileSize/50)+1,ctx.strokeStyle="rgba(255,255,255,0.3)",ctx.beginPath();for(let t=camera.x%1*tileSize;t<Width;t+=tileSize)ctx.moveTo(t,0),ctx.lineTo(t,Height);for(let a=camera.y%1*tileSize;a<Height;a+=tileSize)ctx.moveTo(0,a),ctx.lineTo(Width,a);ctx.stroke();let i=Date.now();for(let r=camera.particles.length-1;r>-1;r--){let o=camera.particles[r];o.update(i),"del"==o.draw()&&camera.particles.splice(r,1)}i=Date.now(),mouseDown&&(ctx.lineWidth=5,ctx.strokeStyle="rgba(255,150,40,0.6)",ctx.beginPath(),ctx.moveTo(mouseDownPlace[2],mouseDownPlace[3]),ctx.lineTo(mouseX,mouseY),ctx.stroke(),"none"===pieceDowned||(board.tiles[spos(mouseBoardX,mouseBoardY)]?.piece==pieceDowned||!0===pieceDowned.held&&pieceDowned.alive?void 0!=pieceDowned.hold&&pieceDowned.hold(i):!0===pieceDowned.held&&piece.alive||(pieceDowned="none"))),camera.specialRenderOn&&specialRender(),camera.escaped&&menuRender(0,0),fill(255,0,0,.3),mrect(mouseBoardX,mouseBoardY),fill(125,0,255,.3),ctx.fillRect(0,0,camera.menuButtonSize,camera.menuButtonSize)}specialRenderIn(),document.addEventListener("mouseup",e=>{if(mouseDown=!1,mouseToBoardUpdate(),"none"!==pieceDowned){let t=pieceDowned.held;if(t&&pieceDowned.unhold(mouseBoardX,mouseBoardY),t){pieceDowned="none";return}pieceDowned="none"}if(mouseX<camera.menuButtonSize&&mouseY<camera.menuButtonSize){escaped();return}if(mouseDownPlace[0]==mouseBoardX&&mouseDownPlace[1]==mouseBoardY){let a=mouseBoardX,i=mouseBoardY;if(pieceClicked="none",camera.escaped){let r=a+Math.floor(camera.escapePos[0]),o=i+Math.floor(camera.escapePos[1]);0===r?1===o?("image"==camera.pieceRender?camera.pieceRender="text":camera.pieceRender="image",camera.playSound("select")):3===o?(camera.soundOn=!camera.soundOn,camera.playSound("select")):5===o?camera.playSound(initSoundsArr[Math.floor(Math.random()*initSoundsArr.length)]):7===o?camera.increaseMargin-=1:9===o?camera.menuButtonSize-=camera.increaseMargin:11===o?((tileSize-=camera.increaseMargin)<2&&(tileSize=2),camera.tileRsize=tileSize/50):-2===o?"started"!=gameStart?(window.open("","_self").close(),clearInterval(renderInterval),drawText("Please kill manually",-camera.x,-camera.y),drawText("Static game started",-camera.x,-camera.y+1)):(stopGame(),escaped()):-4===o&&(camera.x=0,camera.y=0,camera.playSound("select")):1===r&&(7===o?camera.increaseMargin+=1:9===o?camera.menuButtonSize+=camera.increaseMargin:11===o&&((tileSize+=camera.increaseMargin)<2&&(tileSize=2),camera.tileRsize=tileSize/50));return}if("started"!=gameStart){"mode"==gameStart&&0==mouseBoardX&&(0==mouseBoardY?(camera.gamemode="Normal",gameStart="started",startGame()):2==mouseBoardY?(camera.gamemode="King's Raid",gameStart="started",startGame()):4==mouseBoardY?(camera.gamemode="Knight's Raid",gameStart="started",startGame()):6==mouseBoardY?(camera.gamemode="Roaming",gameStart="started",startGame()):8==mouseBoardY?(camera.gamemode="Phantom",gameStart="started",startGame()):10==mouseBoardY&&(camera.gamemode="Universal",gameStart="started",startGame()));return}let s=board.tiles[mouseBoardX+","+mouseBoardY];if(void 0!=s&&void 0!=s.piece&&s.piece.team==camera.team){s.piece.temporaryLegals=s.piece.legals().arr,(pieceSelected=s.piece).premoves=[];return}}let c=attemptMove(mouseDownPlace[0],mouseDownPlace[1],mouseBoardX,mouseBoardY,camera.team);!1!==c?friendlyMoved(c):0!=pieceClicked.cooldown&&"none"!=pieceClicked&&pieceClicked.premoves.push([mouseBoardX,mouseBoardY]),pieceSelected="none",pieceClicked="none",console.log(pieceClicked)}),ctx.font="bold "+Math.floor(.8*tileSize)+"px Courier New";let renderInterval=setInterval(()=>{render()},35),gameInterval,gameSpecialInterval=()=>{};function startGame(){if(camera.specialRenderOn=!1,board.emptyNew(),"Roaming"==camera.gamemode){for(let e=0;e<32;e++)for(let t=0;t<32;t++)board.tiles[e+","+t]={};board.tiles["16,16"].color=()=>"rgb(0,200,200)",camera.pieceFrequency=2935209357230,board.tiles["16,16"].piece=new piece("rook",16,16,"p1");let a=board.tiles["16,16"].piece;a.maxCD=.2,a.onDeath=()=>{mainPieceDeath(a),clearInterval(gameInterval),gameStart="lost"}}else if("Knight's Raid"==camera.gamemode){camera.pieceFrequency=1700,gameSpecialInterval=()=>{if(board.iterations%18==0&&board.iterations>30)for(let e=0;e<4;e++)board.spawnRates[2*e+1]-=(1-board.spawnRates[2*e+1])*(1-board.spawnRates[2*e+1])*.2,board.spawnRates[2*e+1]<(e+1)*.1&&(board.spawnRates[2*e+1]=(e+1)*.1);board.iterations%20==0&&camera.pieceFrequency>1300&&(camera.pieceFrequency-=50,startGameInterval(camera.pieceFrequency))},board.tiles["4,11"].piece=new piece("knight",4,11,"p1");let i=board.tiles["4,11"].piece;i.maxCD=.2,i.onDeath=()=>{mainPieceDeath(i),clearInterval(gameInterval),gameStart="lost"}}else if("King's Raid"==camera.gamemode){gameSpecialInterval=()=>{if(board.iterations%12==0&&board.iterations>120){for(let e=0;e<4;e++)board.spawnRates[2*e+1]-=(1-board.spawnRates[2*e+1])*(1-board.spawnRates[2*e+1])*.2,board.spawnRates[2*e+1]<(e+1)*.1&&(board.spawnRates[2*e+1]=(e+1)*.1);console.log(board.spawnRates)}board.iterations%20==0&&camera.pieceFrequency>950&&(camera.pieceFrequency-=50,startGameInterval(camera.pieceFrequency))},board.tiles["4,11"].piece=new piece("king",4,11,"p1");let r=board.tiles["4,11"].piece;r.maxCD=.2,r.onDeath=()=>{mainPieceDeath(r),clearInterval(gameInterval),gameStart="lost"}}else if("Phantom"==camera.gamemode){camera.pieceFrequency=2e3,gameSpecialInterval=()=>{if(board.iterations%12==0&&board.iterations>40){for(let e=0;e<4;e++)board.spawnRates[2*e+1]-=(1-board.spawnRates[2*e+1])*(1-board.spawnRates[2*e+1])*.2,board.spawnRates[2*e+1]<(e+1)*.1&&(board.spawnRates[2*e+1]=(e+1)*.1);console.log(board.spawnRates)}board.iterations%20==0&&camera.pieceFrequency>950&&(camera.pieceFrequency-=25,startGameInterval(camera.pieceFrequency))},board.tiles["4,11"].piece=new piece("king",4,11,"p1");let o=board.tiles["4,11"].piece;o.maxCD=.2,board.arrFuncs.pieceModifiers.push(e=>{e.draw=(e,t,a,i,r,o)=>{(fill(0,100,0,r),"image"===camera.pieceRender&&void 0!=pieceDict[e])?pieceImage(t,a,pieceDict[e]):ctx.fillText(e,(t+camera.x+.5)*tileSize,(a+camera.y+.56)*tileSize)},setPieceCooldown(e,3)}),board.arrFuncs.pieceModifiers.push(e=>{e.arrFuncs.onMove.push((e,t,a,i)=>{camera.particles.push(new lineParticle(e+.5,t+.5,a.x+.5,a.y+.5,10,e=>"rgb(0,"+(125*Math.random()+125)/2+",0)",1))})}),board.AIwait=()=>5e3*Math.random()+10,board.AIblockWait=()=>1e4*Math.random()+10,o.onDeath=()=>{mainPieceDeath(o),clearInterval(gameInterval),gameStart="lost"}}else if("Normal"==camera.gamemode){camera.pieceFrequency=1e4,gameSpecialInterval=()=>{if(board.iterations%18==0&&board.iterations>30)for(let e=0;e<4;e++)board.spawnRates[2*e+1]-=(1-board.spawnRates[2*e+1])*(1-board.spawnRates[2*e+1])*.2,board.spawnRates[2*e+1]<(e+1)*.1&&(board.spawnRates[2*e+1]=(e+1)*.1);board.iterations%10==0&&camera.pieceFrequency>8500&&(camera.pieceFrequency-=25,startGameInterval(camera.pieceFrequency))};for(let s=0;s<8;s++)board.tiles[s+",10"].piece=new piece("pawn",s,10,"p1",{direction:"y-"});board.tiles["0,11"].piece=new piece("rook",0,11,"p1"),board.tiles["1,11"].piece=new piece("knight",1,11,"p1"),board.tiles["2,11"].piece=new piece("bishop",2,11,"p1"),board.tiles["3,11"].piece=new piece("queen",3,11,"p1"),board.tiles["4,11"].piece=new piece("king",4,11,"p1"),board.tiles["5,11"].piece=new piece("bishop",5,11,"p1"),board.tiles["6,11"].piece=new piece("knight",6,11,"p1"),board.tiles["7,11"].piece=new piece("rook",7,11,"p1"),board.tiles["7,9"].piece=new piece("wizard",7,9,"p1"),board.AIwait=()=>4e3*Math.random(),board.AIblockWait=()=>4e3*Math.random()+3e3}else if("Universal"==camera.gamemode){camera.pieceFrequency=9e3,gameSpecialInterval=()=>{if(board.iterations%18==0&&board.iterations>30)for(let e=0;e<4;e++)board.spawnRates[2*e+1]-=(1-board.spawnRates[2*e+1])*(1-board.spawnRates[2*e+1])*.2,board.spawnRates[2*e+1]<(e+1)*.1&&(board.spawnRates[2*e+1]=(e+1)*.1);board.iterations%10==0&&camera.pieceFrequency>7500&&(camera.pieceFrequency-=25,startGameInterval(camera.pieceFrequency))},board.arrFuncs.pieceModifiers.push(e=>{e.maxCD=10});for(let c=0;c<8;c++)board.tiles[c+",10"].piece=new piece("pawn",c,10,"p1",{direction:"y-"});board.tiles["0,11"].piece=new piece("rook",0,11,"p1"),board.tiles["1,11"].piece=new piece("knight",1,11,"p1"),board.tiles["2,11"].piece=new piece("bishop",2,11,"p1"),board.tiles["3,11"].piece=new piece("queen",3,11,"p1"),board.tiles["4,11"].piece=new piece("king",4,11,"p1"),board.tiles["5,11"].piece=new piece("bishop",5,11,"p1"),board.tiles["6,11"].piece=new piece("knight",6,11,"p1"),board.tiles["7,11"].piece=new piece("rook",7,11,"p1"),board.tiles["0,9"].piece=new piece("cannon",0,9,"p1"),board.tiles["7,9"].piece=new piece("cannon",7,9,"p1");Object.values(board.tiles).forEach(e=>{void 0!=e&&void 0!=e.piece&&(e.piece.maxCD=10)}),board.AIwait=()=>4e3*Math.random(),board.AIblockWait=()=>4e3*Math.random()+3e3}board.spawnRates=["pawn",.7,"king",.85,"knight",.95,"bishop",.98,"rook",1],board.tiles["3,0"].piece=new piece("pawn",3,0,"zombies",{direction:"y+"}),board.tiles["5,0"].piece=new piece("pawn",5,0,"zombies",{direction:"y+"}),board.tiles["6,0"].piece=new piece("pawn",6,0,"zombies",{direction:"y+"}),board.gameFunction=()=>{board.iterations+=1;let e=Math.floor(8*Math.random()),t=board.topTile;for(;void 0==board.tiles[e+","+t]||void 0!=board.tiles[e+","+t].piece;)if((t+=1)>1)return;let a=board.spawnRates[0],i=Math.random();for(let r=0;r<board.spawnRates.length/2;r++)if(i<board.spawnRates[2*r+1]){a=board.spawnRates[2*r];break}if(board.tiles[e+","+t].piece=new piece(a,e,t,"zombies",{direction:"y+"}),board.arrFuncs.pieceModifiers.forEach(a=>{a(board.tiles[e+","+t].piece)}),Math.random()>.5){let o=board.bottomTile-1;for(;Math.random()>.4;)o-=1;let s=Math.floor(8*Math.random());if(void 0==board.tiles[s+","+o]){board.tiles[s+","+o]={},o<board.topTile&&(board.topTile=o);let c=0;for(let l=0;l<8;l++)void 0!=board.tiles[l+","+o]&&(c+=1);c>6&&(board.bottomTile+=1)}}gameSpecialInterval()},startGameInterval(camera.pieceFrequency)}function mainPieceDeath(e){for(let t=0;t<26;t++){let a=Math.random()-.5,i=Math.random()-.5;camera.particles.push(new bloodParticle(e.x+.5+.6*a,e.y+.5+.6*i,24*a,24*i,.03*Math.random(),3*Math.random()+3,!1)),camera.particles[camera.particles.length-1].friction=.97,camera.particles[camera.particles.length-1].color="rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.6*Math.random()+.4)+")"}for(let r=0;r<2*e.kills;r++)setTimeout(()=>{let t=Math.random()-.5,a=Math.random()-.5;camera.particles.push(new bloodParticle(e.x+.5+.6*t,e.y+.5+.6*a,24*t,24*a,.03*Math.random(),3*Math.random()+3,!1)),camera.particles[camera.particles.length-1].friction=.97,camera.particles[camera.particles.length-1].color="rgba("+(235*Math.random()+20)+","+15*Math.random()+","+15*Math.random()+","+(.6*Math.random()+.4)+")"},40*r);displayKills(e.kills,e.x,e.y,1,2),camera.particles.push(new explosionR(e.x+.5,e.y+.5,e=>{let t=250*Math.random();return"rgba("+t+","+t+","+(250-t)+","+2.5*e+")"},2,.7,1))}function startGameInterval(e){clearInterval(gameInterval),gameInterval=setInterval(()=>{board.gameFunction()},e)}function stopGame(){specialRenderIn(),board.arrFuncs.pieceModifiers=[],board.AIwait=()=>10,board.AIblockWait=()=>300,camera.pieceFrequency=1300,clearInterval(gameInterval),board.tiles={},board.iterations=0,camera.specialRenderOn=!0,gameStart="mode"}function touchHandler(e){console.log(e.type);var t=e.changedTouches[0],a="";switch(e.type){case"touchstart":a="mousedown";break;case"touchmove":a="mousemove";break;case"touchend":case"touchcancel":a="mouseup";break;default:return}"mouseup"!==a&&(mouseX=e.touches[0].clientX,mouseY=e.touches[0].clientY);var i=document.createEvent("MouseEvent");"touchend"==e.type&&console.log("t4"),i.initMouseEvent(a,!0,!0,window,1,t.screenX,t.screenY,t.clientX,t.clientY,!1,!1,!1,!1,0,null),"touchend"==e.type&&console.log("t5"),document.body.dispatchEvent(i),e.preventDefault()}function init(){document.addEventListener("touchstart",touchHandler,!0),document.addEventListener("touchmove",e=>{touchHandler(e)},!0),document.addEventListener("touchend",touchHandler,!0),document.addEventListener("touchcancel",touchHandler,!0)}var sampler1=new Tone.Sampler({urls:{C2:"./sounds/captureF.wav",C4:"./sounds/move.wav","C#4":"./sounds/capture.wav",D4:"./sounds/captureS1.wav","D#4":"./sounds/captureS2.wav",E4:"./sounds/captureS3.wav","E#4":"./sounds/captureS4.wav",F4:"./sounds/captureS5.wav","F#4":"./sounds/captureS6.wav",G4:"./sounds/captureS7.wav","G#4":"./sounds/captureS8.wav"}}).toDestination(),sampler2=new Tone.Players({1:"./sounds/select.wav"}).toDestination();let soundMapper={0:"C2",1:"C4",2:"C#4",3:"D4",4:"D#4",5:"E4",6:"F4",7:"F#4",8:"G4",9:"G#4",10:"A4",11:"A#4",12:"B4",13:"C5",14:"C#5",15:"D5",16:"D#5",17:"E5",18:"F5",19:"F#5",20:"G5",21:"G#5",22:"A5",23:"A#5",24:"B5",25:"C6",26:"C#6",27:"D6",28:"D#6",29:"E6",30:"F6",31:"F#6",32:"G6",33:"G#6",34:"A6",35:"A#6",36:"B6",37:"C7"};function escaped(){if("lost"==gameStart){stopGame(),camera.playSound("escape");return}camera.escaped=!camera.escaped,camera.escapePos=[camera.x,camera.y],camera.playSound("escape")}Tone.loaded().then(()=>{sampler1.triggerAttack(["C4"])}),document.querySelector("button")?.addEventListener("click",async()=>{await Tone.start(),console.log("audio is ready")});